{"version":3,"sources":["../../src/directives/all.js"],"names":[],"mappings":"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","file":"all.js","sourcesContent":["import angular from 'angular';\nimport _ from 'lodash';\n\nangular.module('grafana.directives').directive(\"rtEndpointHealthDashboard\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealthDashboard.html',\n    scope: {\n      ctrl: \"=\",\n      endpoint: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtCheckHealth\", function($compile, datasourceSrv, timeSrv) {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/checkHealth.html',\n    scope: {\n      model: \"=\",\n    },\n    link: function(scope) {\n      scope.$watch(\"model\", function(monitor) {\n        scope.eventReady = false;\n        if (typeof(monitor) === \"object\") {\n          timeSrv.init({\n            time: {from: \"now-\"+(monitor.frequency + 30)+ 's', to: \"now\"}\n          });\n          var metricsQuery = {\n            range: timeSrv.timeRange(),\n            rangeRaw: timeSrv.timeRange(true),\n            interval: monitor.frequency + 's',\n            targets: [\n              {target: \"litmus.\"+monitor.endpoint_slug + \".*.\" +\n                monitor.monitor_type_name.toLowerCase()+\".{ok_state,warn_state,error_state}\"}\n            ],\n            format: 'json',\n            maxDataPoints: 10,\n          };\n\n          var datasource = datasourceSrv.get('raintank');\n          datasource.then(function(ds) {\n            ds.query(metricsQuery).then(function(results) {\n              showHealth(results);\n            }, function() {\n              showHealth({data: []});\n            });\n          });\n        }\n      });\n\n      function showHealth(metrics) {\n        var okCount = 0;\n        var warnCount = 0;\n        var errorCount = 0;\n        var unknownCount = 0;\n        var collectorResults = {};\n        _.forEach(metrics.data, function(result) {\n          var parts = result.target.split('.');\n          var stateStr = parts[4];\n          var collector = parts[2];\n          if (!(collector in collectorResults)) {\n            collectorResults[collector] = {ts: -1, state: -1};\n          }\n\n          //start with the last point and work backwards till we find a non-null value.\n          for (var i = result.datapoints.length - 1 ; i >= 0; i--) {\n            var point = result.datapoints[i];\n            if (!isNaN(point[0])) {\n              if ((point[0] === 1) && (point[1] > collectorResults[collector].ts)) {\n                collectorResults[collector].ts = point[1];\n                switch (stateStr) {\n                  case 'ok_state':\n                    collectorResults[collector].state = 0;\n                    break;\n                  case 'warn_state':\n                    collectorResults[collector].state = 1;\n                    break;\n                  case 'error_state':\n                    collectorResults[collector].state = 2;\n                    break;\n                  default:\n                    collectorResults[collector].state = -1;\n                    console.log(\"unknown state returned. this shouldnt happen :(\");\n                }\n                break;\n              }\n            }\n          }\n        });\n        for (var col in collectorResults) {\n          switch (collectorResults[col].state) {\n          case 0:\n            okCount++;\n            break;\n          case 1:\n            warnCount++;\n            break;\n          case 2:\n            errorCount++;\n            break;\n          default:\n            unknownCount++;\n          }\n        }\n        var unknowns = scope.model.collectors.length - Object.keys(collectorResults).length;\n        unknownCount += unknowns;\n\n        scope.okCount = okCount;\n        scope.warnCount = warnCount;\n        scope.errorCount = errorCount;\n        scope.unknownCount = unknownCount;\n        scope.eventReady = true;\n      }\n    }\n  };\n});\n\nangular.module('grafana.directives').directive(\"rtEndpointHealth\", function() {\n  return {\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointHealth.html',\n    scope: {\n      endpoint: \"=\",\n      ctrl: \"=\"\n    }\n  };\n});\n\nangular.module('grafana.directives').directive('endpointCollectorSelect', function($compile, $window, $timeout) {\n  return {\n    scope: {\n      collectors: \"=\",\n      model: \"=\",\n    },\n    templateUrl: 'public/plugins/raintank-worldping-app/directives/partials/endpointCollectorSelect.html',\n    link: function(scope, elem) {\n      var bodyEl = angular.element($window.document.body);\n      var currentIds = scope.model.collector_ids;\n      var currentTags = scope.model.collector_tags;\n      scope.init = function() {\n        currentIds = scope.model.collector_ids;\n        currentTags = scope.model.collector_tags;\n        scope.footprint = {value: \"static\"};\n        scope.error = false;\n\n        // determine if we are using static or dynamic allocation.\n        if (currentIds.length > 0) {\n          scope.footprint.value = 'static';\n          _.forEach(scope.tags, function(t) {\n            t.selected = false;\n          });\n        } else if (currentTags.length > 0) {\n          scope.footprint.value = 'dynamic';\n          _.forEach(scope.ids, function(i) {\n            i.selected = false;\n          });\n        }\n        scope.reset();\n      };\n\n      scope.reset = function() {\n        scope.error = false;\n        scope.ids = [];\n        scope.tags = [];\n        //build out our list of collectorIds and tags\n        var seenTags = {};\n        _.forEach(scope.collectors, function(c) {\n          var option = {id: c.id, selected: false, text: c.name};\n          if (_.indexOf(currentIds, c.id) >= 0) {\n            option.selected = true;\n          }\n          _.forEach(c.tags, function(t) {\n            if (!(t in seenTags)) {\n              seenTags[t] = true;\n              var o = {selected: false, text: t};\n              if (_.indexOf(currentTags, t) >= 0) {\n                o.selected = true;\n              }\n              scope.tags.push(o);\n            }\n          });\n          scope.ids.push(option);\n        });\n        if (scope.footprint.value === 'dynamic') {\n          _.forEach(scope.ids, function(i) {\n            i.selected = false;\n          });\n        } else {\n          _.forEach(scope.tags, function(t) {\n            t.selected = false;\n          });\n        }\n      };\n\n      scope.show = function() {\n        scope.reset();\n        scope.selectorOpen = true;\n        scope.giveFocus = 1;\n\n        $timeout(function() {\n          bodyEl.on('click', scope.bodyOnClick);\n        }, 0, false);\n      };\n\n      scope.idSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.selectAll = function() {\n        var select = true;\n        var selectedIds = _.filter(scope.ids, {selected: true});\n\n        if (selectedIds.length === scope.ids.length) {\n          select = false;\n        }\n        _.forEach(scope.ids, function(option) {\n          option.selected = select;\n        });\n      };\n\n      scope.tagSelected = function(option) {\n        option.selected = !option.selected;\n      };\n\n      scope.collectorsWithTags = function() {\n        var collectorList = {};\n        _.forEach(scope.collectors, function(c) {\n          _.forEach(_.filter(scope.tags, {selected: true}), function(t) {\n            if (_.indexOf(c.tags, t.text) !== -1) {\n              collectorList[c.name] = true;\n            }\n          });\n        });\n        return Object.keys(collectorList).join(', ');\n      };\n\n      scope.collectorCount = function(tag) {\n        var count = 0;\n        _.forEach(scope.collectors, function(c) {\n          if (_.indexOf(c.tags, tag.text) !== -1) {\n            count++;\n          }\n        });\n        return count;\n      };\n\n      scope.selectTagTitle = function() {\n        var selectedTags = _.filter(scope.tags, {selected: true});\n        if (selectedTags.length === 0) {\n          return \"Select Tags\";\n        }\n        if (selectedTags.length <= 2) {\n          return _.pluck(selectedTags, 'text').join(\", \");\n        }\n        return _.pluck(selectedTags, 'text').slice(0, 2).join(\", \") + \" and \" + (selectedTags.length - 2) + \" more\";\n      };\n\n      scope.selectIdTitle = function() {\n        var selectedIds = _.filter(scope.ids, {selected: true});\n        if (selectedIds.length === 0) {\n          return \"Select Probes\";\n        }\n        if (selectedIds.length <= 2) {\n          return _.pluck(selectedIds, 'text').join(\", \");\n        }\n        return _.pluck(selectedIds, 'text').slice(0, 2).join(\", \") + \" and \" + (selectedIds.length - 2) + \" more\";\n      };\n\n      scope.hide = function() {\n        var selectedIds = _.filter(scope.ids, {selected: true});\n        var selectedTags = _.filter(scope.tags, {selected: true});\n        if (selectedIds.length === 0 && selectedTags.length === 0) {\n          scope.error = \"at least 1 option must be selected.\";\n          return;\n        }\n\n        scope.model.collector_ids.splice(0,scope.model.collector_ids.length);\n        _.forEach(selectedIds, function(c) {\n          scope.model.collector_ids.push(c.id);\n        });\n        scope.model.collector_tags.splice(0, scope.model.collector_tags.length);\n        _.forEach(selectedTags, function(t) {\n          scope.model.collector_tags.push(t.text);\n        });\n        scope.selectorOpen = false;\n        bodyEl.off('click', scope.bodyOnClick);\n      };\n\n      scope.bodyOnClick = function(e) {\n        var dropdown = elem.find('.variable-value-dropdown');\n        if (dropdown.has(e.target).length === 0) {\n          scope.$apply(scope.hide);\n        }\n      };\n\n      scope.$watch('model.id', function() {\n        scope.init();\n      });\n    },\n  };\n});\n"]}