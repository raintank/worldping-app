{"version":3,"sources":["../../../src/panels/endpoint-list/module.js"],"names":[],"mappings":"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","file":"module.js","sourcesContent":["import '../../filters/all';\nimport '../../directives/all';\nimport _ from 'lodash';\nimport {PanelCtrl} from 'app/plugins/sdk';\nimport {loadPluginCss} from 'app/plugins/sdk';\n\nloadPluginCss({\n  dark: 'plugins/raintank-worldping-app/css/worldping.dark.css',\n  light: 'plugins/raintank-worldping-app/css/worldping.light.css'\n});\n\nclass EndpointListCtrl extends PanelCtrl {\n  /** @ngInject */\n  constructor($scope, $injector, $location, backendSrv) {\n    super($scope, $injector);\n    this.backendSrv = backendSrv;\n    this.$location = $location;\n    this.pageReady = false;\n    this.statuses = [\n      {label: \"Ok\", value: 0},\n      {label: \"Warning\", value: 1},\n      {label: \"Error\", value: 2},\n      {label: \"Unknown\", value: -1},\n    ];\n    this.filter = {'tag': '', 'status': ''};\n    this.sort_field = 'name';\n    this.endpoints = [];\n    this.refresh();\n    this.endpointState = {\n      \"0\": 0,\n      \"1\": 0,\n      \"2\": 0,\n      \"-1\": 0,\n    };\n  }\n\n  initEditMode() {\n    super.initEditMode();\n    this.icon = 'fa fa-text-width';\n    this.addEditorTab('Options', 'public/plugins/raintank-worldping-app/panels/endpoint-list/editor.html');\n    this.editorTabIndex = 1;\n  }\n\n  refresh() {\n    this.getEndpoints();\n  }\n\n   endpointTags() {\n    var map = {};\n    _.forEach(this.endpoints, function(endpoint) {\n      _.forEach(endpoint.tags, function(tag) {\n        map[tag] = true;\n      });\n    });\n    return Object.keys(map);\n  }\n\n  setTagFilter(tag) {\n    this.filter.tag = tag;\n  };\n\n  setStatusFilter(status) {\n    if (status === this.filter.status) {\n      status = \"\";\n    }\n    this.filter.status = status;\n  }\n\n  statusFilter(actual, expected) {\n    if (expected === \"\" || expected === null) {\n      return true;\n    }\n    var equal = (actual === expected);\n    return equal;\n  }\n\n  isEndPointReady(endpoint) {\n    return endpoint && endpoint.hasOwnProperty('ready') &&  endpoint.ready;\n  };\n\n  getEndpoints() {\n    var self = this;\n    this.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/endpoints').then(function(endpoints) {\n      self.pageReady = true;\n      _.forEach(endpoints, function(endpoint) {\n        endpoint.states = [];\n        endpoint.monitors = {};\n        endpoint.ready = false;\n        self.backendSrv.get('api/plugin-proxy/raintank-worldping-app/api/monitors', {\"endpoint_id\": endpoint.id}).then(function(monitors) {\n          var seenStates = {};\n          _.forEach(monitors, function(mon) {\n            if (!mon.enabled) {\n              return;\n            }\n            seenStates[mon.state] = true;\n            endpoint.monitors[mon.monitor_type_name.toLowerCase()] = mon;\n          });\n          for (var s in seenStates) {\n            self.endpointState[s]++;\n            endpoint.states.push(parseInt(s));\n          }\n          endpoint.ready = true;\n        });\n      });\n      self.endpoints = endpoints;\n    });\n  }\n\n  remove(endpoint) {\n    var self = this;\n    this.backendSrv.delete('api/plugin-proxy/raintank-worldping-app/api/endpoints/' + endpoint.id).then(function() {\n      self.getEndpoints();\n    });\n  }\n\n  monitorStateTxt(endpoint, type) {\n    var mon = endpoint.monitors[type];\n    if (typeof(mon) !== \"object\") {\n      return \"disabled\";\n    }\n    if (!mon.enabled) {\n      return \"disabled\";\n    }\n    if (mon.state < 0 || mon.state > 2) {\n      return 'nodata';\n    }\n    var states = [\"online\", \"warn\", \"critical\"];\n    return states[mon.state];\n  }\n\n  monitorStateChangeStr(endpoint, type) {\n    var mon = endpoint.monitors[type];\n    if (typeof(mon) !== \"object\") {\n      return \"\";\n    }\n    var duration = new Date().getTime() - new Date(mon.state_change).getTime();\n    if (duration < 10000) {\n      return \"for a few seconds ago\";\n    }\n    if (duration < 60000) {\n      var secs = Math.floor(duration/1000);\n      return \"for \" + secs + \" seconds\";\n    }\n    if (duration < 3600000) {\n      var mins = Math.floor(duration/1000/60);\n      return \"for \" + mins + \" minutes\";\n    }\n    if (duration < 86400000) {\n      var hours = Math.floor(duration/1000/60/60);\n      return \"for \" + hours + \" hours\";\n    }\n    var days = Math.floor(duration/1000/60/60/24);\n    return \"for \" + days + \" days\";\n  }\n\n  gotoDashboard(endpoint) {\n    this.$location.path(\"/dashboard/db/worldping-endpoint-summary\").search({\"var-collector\": \"All\", \"var-endpoint\": endpoint.slug});\n  }\n\n  gotoEndpointURL(endpoint) {\n    this.$location.url('plugins/raintank-worldping-app/page/endpoint-details?endpoint='+ endpoint.id);\n  };\n}\nEndpointListCtrl.templateUrl = 'public/plugins/raintank-worldping-app/components/endpoint/partials/endpoint_list.html'\n\n\nexport {EndpointListCtrl as PanelCtrl}"]}